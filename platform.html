<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–æ–∏ —É—Ä–æ–∫–∏ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --purple: #7c3aed;
  --purple-light: rgba(124,58,237,.08);
  --purple-border: rgba(124,58,237,.25);
  --pink: #db2777;
  --bg: #f8f8fc;
  --card: #fff;
  --border: #e5e7eb;
  --text: #1a1a2e;
  --muted: #6b7280;
  --danger: #dc2626;
  --orange: #ea580c;
}

body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; -webkit-font-smoothing: antialiased; }

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
#login-screen {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.login-card {
  background: var(--card);
  border-radius: 20px;
  padding: 40px;
  max-width: 380px;
  width: 100%;
  box-shadow: 0 4px 32px rgba(0,0,0,.08);
  border: 1.5px solid var(--border);
}

.login-logo {
  text-align: center;
  margin-bottom: 32px;
}
.login-logo h1 {
  font-size: 1.6rem;
  font-weight: 900;
  letter-spacing: -.03em;
  background: linear-gradient(135deg, var(--purple), var(--pink));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 6px;
}
.login-logo p { color: var(--muted); font-size: .82rem; font-weight: 500; }

.field { margin-bottom: 16px; }
.field label { display: block; font-size: .75rem; font-weight: 700; color: var(--text); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .5px; }
.field input {
  width: 100%;
  padding: 11px 14px;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: .88rem;
  font-family: inherit;
  color: var(--text);
  background: #fafafa;
  transition: border-color .15s;
  outline: none;
}
.field input:focus { border-color: var(--purple); background: #fff; }

.btn-primary {
  width: 100%;
  padding: 13px;
  background: var(--purple);
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: .88rem;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  transition: background .15s;
  margin-top: 4px;
}
.btn-primary:hover { background: #6d28d9; }
.btn-primary:disabled { background: #a78bfa; cursor: not-allowed; }

.login-error { color: var(--danger); font-size: .8rem; font-weight: 600; margin-top: 10px; text-align: center; min-height: 20px; }

/* ‚îÄ‚îÄ PLATFORM ‚îÄ‚îÄ */
#platform-screen { display: none; }

.header {
  background: #fff;
  border-bottom: 1.5px solid var(--border);
  padding: 0 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 56px;
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-left { display: flex; align-items: center; gap: 12px; }
.header-title {
  font-size: 1rem;
  font-weight: 900;
  letter-spacing: -.02em;
  background: linear-gradient(135deg, var(--purple), var(--pink));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Role badge */
.role-badge {
  padding: 3px 10px;
  border-radius: 20px;
  font-size: .68rem;
  font-weight: 700;
  letter-spacing: .3px;
}
.role-admin { background: rgba(124,58,237,.12); color: var(--purple); border: 1px solid var(--purple-border); }
.role-student { background: rgba(16,185,129,.1); color: #059669; border: 1px solid rgba(16,185,129,.25); }

.header-right { display: flex; align-items: center; gap: 10px; }

.btn-add {
  padding: 7px 16px;
  background: var(--purple);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: .78rem;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  transition: background .15s;
}
.btn-add:hover { background: #6d28d9; }

.btn-logout {
  padding: 7px 12px;
  background: none;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  font-size: .78rem;
  font-weight: 600;
  color: var(--muted);
  cursor: pointer;
  font-family: inherit;
  transition: all .15s;
}
.btn-logout:hover { border-color: var(--danger); color: var(--danger); }

.main { max-width: 800px; margin: 0 auto; padding: 32px 20px 80px; }

/* Tabs */
.tabs { display: flex; gap: 6px; margin-bottom: 24px; flex-wrap: wrap; }
.tab {
  padding: 8px 18px;
  border-radius: 8px;
  border: 1.5px solid var(--border);
  background: #fff;
  color: var(--muted);
  font-size: .8rem;
  font-weight: 700;
  cursor: pointer;
  font-family: inherit;
  transition: all .15s;
}
.tab:hover { border-color: var(--purple-border); color: var(--purple); }
.tab.active { border-color: var(--purple); background: var(--purple-light); color: var(--purple); }
.tab-count { display: inline-block; background: var(--border); border-radius: 20px; padding: 1px 7px; font-size: .68rem; margin-left: 4px; }
.tab.active .tab-count { background: var(--purple-border); }

/* Cards */
.cards-list { display: flex; flex-direction: column; gap: 12px; }

.card {
  background: var(--card);
  border: 1.5px solid var(--border);
  border-radius: 14px;
  overflow: hidden;
  transition: border-color .15s;
}
.card:hover { border-color: #d1d5db; }

/* Hidden card ‚Äî admin only, dashed border */
.card.is-hidden {
  border-style: dashed;
  opacity: .65;
}
.card.is-hidden:hover { border-color: #9ca3af; opacity: .8; }

.card-header {
  padding: 16px 20px;
  display: flex;
  align-items: flex-start;
  gap: 14px;
  cursor: pointer;
  user-select: none;
}

.card-type-badge {
  flex-shrink: 0;
  margin-top: 1px;
  padding: 3px 9px;
  border-radius: 6px;
  font-size: .65rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .5px;
}
.badge-lesson { background: rgba(124,58,237,.1); color: var(--purple); }
.badge-practice { background: rgba(234,88,12,.1); color: var(--orange); }
.badge-hidden { background: #f3f4f6; color: #9ca3af; margin-left: 4px; }

.card-meta { flex: 1; min-width: 0; }
.card-title { font-size: .95rem; font-weight: 700; color: var(--text); line-height: 1.35; }
.card-date { font-size: .72rem; color: var(--muted); margin-top: 3px; font-weight: 500; }
.card-tags { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 6px; }
.tag { padding: 2px 8px; background: #f3f4f6; border-radius: 5px; font-size: .67rem; font-weight: 600; color: #4b5563; }

.card-toggle { flex-shrink: 0; color: var(--muted); font-size: .75rem; margin-top: 2px; transition: transform .2s; }
.card.expanded .card-toggle { transform: rotate(180deg); }

.card-body {
  display: none;
  padding: 0 20px 18px;
  border-top: 1px solid var(--border);
}
.card.expanded .card-body { display: block; }

.card-content {
  padding-top: 14px;
  font-size: .88rem;
  line-height: 1.7;
  color: #374151;
  white-space: pre-wrap;
  word-break: break-word;
}

.card-actions { display: flex; gap: 8px; margin-top: 14px; padding-top: 12px; border-top: 1px solid #f3f4f6; flex-wrap: wrap; }
.btn-sm {
  padding: 5px 12px;
  border-radius: 6px;
  font-size: .73rem;
  font-weight: 600;
  cursor: pointer;
  font-family: inherit;
  border: 1.5px solid transparent;
  transition: all .15s;
}
.btn-edit { background: #f9fafb; border-color: var(--border); color: #374151; }
.btn-edit:hover { border-color: var(--purple); color: var(--purple); }
.btn-hide { background: #f9fafb; border-color: var(--border); color: #374151; }
.btn-hide:hover { border-color: #f59e0b; color: #d97706; }
.btn-show { background: rgba(245,158,11,.08); border-color: rgba(245,158,11,.3); color: #d97706; }
.btn-show:hover { border-color: #f59e0b; background: rgba(245,158,11,.14); }
.btn-delete { background: none; border-color: transparent; color: #9ca3af; margin-left: auto; }
.btn-delete:hover { color: var(--danger); }

/* Empty state */
.empty { text-align: center; padding: 60px 20px; color: var(--muted); }
.empty-icon { font-size: 2.5rem; margin-bottom: 12px; }
.empty h3 { font-size: .95rem; font-weight: 700; color: #374151; margin-bottom: 6px; }
.empty p { font-size: .82rem; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 200;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.modal-overlay.open { display: flex; }

.modal {
  background: #fff;
  border-radius: 20px;
  padding: 32px;
  max-width: 520px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,.18);
}

.modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
.modal-title { font-size: 1.1rem; font-weight: 900; }
.modal-close { background: none; border: none; font-size: 1.2rem; color: var(--muted); cursor: pointer; padding: 4px 8px; line-height: 1; border-radius: 6px; }
.modal-close:hover { background: #f3f4f6; color: var(--text); }

.form-row { margin-bottom: 16px; }
.form-label { display: block; font-size: .75rem; font-weight: 700; color: var(--text); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .5px; }
.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 10px 13px;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: .88rem;
  font-family: inherit;
  color: var(--text);
  background: #fafafa;
  transition: border-color .15s;
  outline: none;
  resize: vertical;
}
.form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--purple); background: #fff; }
.form-textarea { min-height: 160px; line-height: 1.6; }
.form-hint { font-size: .72rem; color: var(--muted); margin-top: 4px; }

.modal-footer { display: flex; gap: 10px; margin-top: 24px; justify-content: flex-end; }
.btn-secondary {
  padding: 10px 20px;
  background: none;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: .84rem;
  font-weight: 600;
  color: var(--muted);
  cursor: pointer;
  font-family: inherit;
  transition: all .15s;
}
.btn-secondary:hover { border-color: #9ca3af; color: var(--text); }

.btn-save {
  padding: 10px 24px;
  background: var(--purple);
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: .84rem;
  font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  transition: background .15s;
}
.btn-save:hover { background: #6d28d9; }

/* Search */
.search-bar { position: relative; margin-bottom: 20px; }
.search-bar input {
  width: 100%;
  padding: 10px 14px 10px 38px;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: .86rem;
  font-family: inherit;
  color: var(--text);
  background: #fff;
  outline: none;
  transition: border-color .15s;
}
.search-bar input:focus { border-color: var(--purple); }
.search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: .9rem; pointer-events: none; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-logo">
      <h1>–ú–æ–∏ —É—Ä–æ–∫–∏</h1>
      <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø—Ä–∞–∫—Ç–∏–∫ –∏ –æ–±—É—á–µ–Ω–∏—è</p>
    </div>
    <div class="field">
      <label>–ü–∞—Ä–æ–ª—å</label>
      <input type="password" id="password-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
    </div>
    <button class="btn-primary" id="login-btn">–í–æ–π—Ç–∏</button>
    <div class="login-error" id="login-error"></div>
  </div>
</div>

<!-- PLATFORM -->
<div id="platform-screen">
  <header class="header">
    <div class="header-left">
      <span class="header-title">–ú–æ–∏ —É—Ä–æ–∫–∏ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏</span>
      <span class="role-badge" id="role-badge"></span>
    </div>
    <div class="header-right">
      <button class="btn-add" id="add-btn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      <button class="btn-logout" id="logout-btn">–í—ã–π—Ç–∏</button>
    </div>
  </header>

  <main class="main">
    <div class="search-bar">
      <span class="search-icon">üîç</span>
      <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏–ª–∏ —Ç–µ–≥–∞–º...">
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="all">–í—Å–µ <span class="tab-count" id="count-all">0</span></button>
      <button class="tab" data-tab="lesson">–£—Ä–æ–∫–∏ <span class="tab-count" id="count-lesson">0</span></button>
      <button class="tab" data-tab="practice">–ü—Ä–∞–∫—Ç–∏–∫–∏ <span class="tab-count" id="count-practice">0</span></button>
    </div>

    <div class="cards-list" id="cards-list"></div>
  </main>
</div>

<!-- MODAL (admin only) -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="modal-title">–ù–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª</span>
      <button class="modal-close" id="modal-close">‚úï</button>
    </div>

    <div class="form-row">
      <label class="form-label">–¢–∏–ø</label>
      <select class="form-select" id="form-type">
        <option value="lesson">–£—Ä–æ–∫</option>
        <option value="practice">–ü—Ä–∞–∫—Ç–∏–∫–∞</option>
      </select>
    </div>

    <div class="form-row">
      <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
      <input type="text" class="form-input" id="form-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—Ä–æ–∫ 3 ‚Äî –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–µ–π">
    </div>

    <div class="form-row">
      <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
      <textarea class="form-textarea" id="form-content" placeholder="–ó–∞–º–µ—Ç–∫–∏, –∫–æ–Ω—Å–ø–µ–∫—Ç, –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏..."></textarea>
    </div>

    <div class="form-row">
      <label class="form-label">–¢–µ–≥–∏ <span style="font-weight:500;text-transform:none;letter-spacing:0">(—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</span></label>
      <input type="text" class="form-input" id="form-tags" placeholder="–Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–ª–∏, —Ä–µ—Ñ–ª–µ–∫—Å–∏—è">
      <div class="form-hint">–¢–µ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn-save" id="modal-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  –ü–ê–†–û–õ–ò
//  –ß—Ç–æ–±—ã —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å, –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
//    await hashPassword('–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å')
//  –∏ –∑–∞–º–µ–Ω–∏ –Ω—É–∂–Ω—ã–π —Ö—ç—à –Ω–∏–∂–µ.
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ADMIN_HASH   = 'ef92b778bafe771207889657c6f0f9aa9b4bf2da17cdfa25a80b6cce56a9abb1'; // admin123
const STUDENT_HASH = '703b0a3d6ad75b649a28adde7d83c6251da457549263bc7ff45ec709b0a8448b'; // student123

const STORAGE_KEY = 'learning_platform_v1';
const SESSION_KEY = 'learning_platform_session';

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
async function hashPassword(password) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(password));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
}

function genId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
}

function formatDate(iso) {
  return new Date(iso).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
}

// ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ
function loadItems() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
  catch { return []; }
}
function saveItems(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let items = loadItems();
let activeTab = 'all';
let searchQuery = '';
let editingId = null;

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
function getRole() {
  try { return JSON.parse(sessionStorage.getItem(SESSION_KEY))?.role || null; }
  catch { return null; }
}
function isAdmin() { return getRole() === 'admin'; }
function isLoggedIn() { return getRole() !== null; }

async function tryLogin() {
  const pw  = document.getElementById('password-input').value;
  const err = document.getElementById('login-error');
  const btn = document.getElementById('login-btn');
  if (!pw) { err.textContent = '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å'; return; }

  btn.disabled = true;
  btn.textContent = '–ü—Ä–æ–≤–µ—Ä—è—é...';

  const hash = await hashPassword(pw);
  let role = null;
  if (hash === ADMIN_HASH)   role = 'admin';
  if (hash === STUDENT_HASH) role = 'student';

  if (role) {
    sessionStorage.setItem(SESSION_KEY, JSON.stringify({ role }));
    showPlatform();
  } else {
    err.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
    btn.disabled = false;
    btn.textContent = '–í–æ–π—Ç–∏';
    document.getElementById('password-input').value = '';
    document.getElementById('password-input').focus();
  }
}

function logout() {
  sessionStorage.removeItem(SESSION_KEY);
  showLogin();
}

function showLogin() {
  document.getElementById('platform-screen').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  setTimeout(() => document.getElementById('password-input').focus(), 50);
}

function showPlatform() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('platform-screen').style.display = 'block';

  // Role badge
  const badge = document.getElementById('role-badge');
  if (isAdmin()) {
    badge.textContent = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
    badge.className = 'role-badge role-admin';
    document.getElementById('add-btn').style.display = 'inline-block';
  } else {
    badge.textContent = '–£—á–µ–Ω–∏–∫';
    badge.className = 'role-badge role-student';
    document.getElementById('add-btn').style.display = 'none';
  }

  renderAll();
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
function visibleToRole(item) {
  // Admin sees everything; student only sees non-hidden
  return isAdmin() || !item.hidden;
}

function getFiltered() {
  return items.filter(item => {
    if (!visibleToRole(item)) return false;
    const matchTab = activeTab === 'all' || item.type === activeTab;
    if (!matchTab) return false;
    if (!searchQuery) return true;
    const q = searchQuery.toLowerCase();
    return item.title.toLowerCase().includes(q) ||
           (item.tags || []).some(t => t.toLowerCase().includes(q)) ||
           (item.content || '').toLowerCase().includes(q);
  });
}

function renderAll() {
  updateCounts();
  renderCards();
}

function updateCounts() {
  const visible = items.filter(i => visibleToRole(i));
  document.getElementById('count-all').textContent     = visible.length;
  document.getElementById('count-lesson').textContent   = visible.filter(i => i.type === 'lesson').length;
  document.getElementById('count-practice').textContent = visible.filter(i => i.type === 'practice').length;
}

function renderCards() {
  const list     = document.getElementById('cards-list');
  const filtered = getFiltered();
  const admin    = isAdmin();

  if (filtered.length === 0) {
    const icon = searchQuery ? 'üîç' : (activeTab === 'lesson' ? 'üìñ' : activeTab === 'practice' ? '‚úçÔ∏è' : 'üìã');
    const head = searchQuery ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–ü–æ–∫–∞ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤';
    const sub  = searchQuery ? '–ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å' : (admin ? '–ù–∞–∂–º–∏ ¬´+ –î–æ–±–∞–≤–∏—Ç—å¬ª, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π' : '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
    list.innerHTML = `<div class="empty"><div class="empty-icon">${icon}</div><h3>${head}</h3><p>${sub}</p></div>`;
    return;
  }

  const sorted = [...filtered].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

  list.innerHTML = sorted.map(item => {
    const typeBadge = item.type === 'lesson'
      ? '<span class="card-type-badge badge-lesson">–£—Ä–æ–∫</span>'
      : '<span class="card-type-badge badge-practice">–ü—Ä–∞–∫—Ç–∏–∫–∞</span>';

    const hiddenBadge = (admin && item.hidden)
      ? '<span class="card-type-badge badge-hidden">–°–∫—Ä—ã—Ç–æ</span>'
      : '';

    const tags = (item.tags || []).length > 0
      ? `<div class="card-tags">${item.tags.map(t => `<span class="tag">${escHtml(t)}</span>`).join('')}</div>`
      : '';

    // Admin actions
    const adminActions = admin ? `
      <div class="card-actions">
        <button class="btn-sm btn-edit" onclick="openEdit(event,'${item.id}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        ${item.hidden
          ? `<button class="btn-sm btn-show" onclick="toggleHide(event,'${item.id}')">–ü–æ–∫–∞–∑–∞—Ç—å —É—á–µ–Ω–∏–∫–∞–º</button>`
          : `<button class="btn-sm btn-hide" onclick="toggleHide(event,'${item.id}')">–°–∫—Ä—ã—Ç—å –æ—Ç —É—á–µ–Ω–∏–∫–æ–≤</button>`}
        <button class="btn-sm btn-delete" onclick="deleteItem(event,'${item.id}')">–£–¥–∞–ª–∏—Ç—å</button>
      </div>` : '';

    const cardBody = (item.content || admin)
      ? `<div class="card-body">
           ${item.content ? `<div class="card-content">${escHtml(item.content)}</div>` : ''}
           ${adminActions}
         </div>`
      : '';

    return `
      <div class="card${item.hidden ? ' is-hidden' : ''}" id="card-${item.id}" onclick="toggleCard(event,'${item.id}')">
        <div class="card-header">
          ${typeBadge}${hiddenBadge}
          <div class="card-meta">
            <div class="card-title">${escHtml(item.title)}</div>
            <div class="card-date">${formatDate(item.createdAt)}</div>
            ${tags}
          </div>
          <span class="card-toggle">‚ñº</span>
        </div>
        ${cardBody}
      </div>`;
  }).join('');
}

function escHtml(str) {
  return String(str)
    .replace(/&/g, '&amp;').replace(/</g, '&lt;')
    .replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function toggleCard(e, id) {
  if (e.target.closest('button')) return;
  document.getElementById('card-' + id).classList.toggle('expanded');
}

// ‚îÄ‚îÄ CRUD ‚îÄ‚îÄ
function openAdd() {
  if (!isAdmin()) return;
  editingId = null;
  document.getElementById('modal-title').textContent = '–ù–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª';
  document.getElementById('form-type').value    = 'lesson';
  document.getElementById('form-title').value   = '';
  document.getElementById('form-content').value = '';
  document.getElementById('form-tags').value    = '';
  openModal();
}

function openEdit(e, id) {
  if (!isAdmin()) return;
  e.stopPropagation();
  const item = items.find(i => i.id === id);
  if (!item) return;
  editingId = id;
  document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
  document.getElementById('form-type').value    = item.type;
  document.getElementById('form-title').value   = item.title;
  document.getElementById('form-content').value = item.content || '';
  document.getElementById('form-tags').value    = (item.tags || []).join(', ');
  openModal();
}

function toggleHide(e, id) {
  if (!isAdmin()) return;
  e.stopPropagation();
  const idx = items.findIndex(i => i.id === id);
  if (idx === -1) return;
  items[idx] = { ...items[idx], hidden: !items[idx].hidden };
  saveItems(items);
  renderAll();
}

function deleteItem(e, id) {
  if (!isAdmin()) return;
  e.stopPropagation();
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª?')) return;
  items = items.filter(i => i.id !== id);
  saveItems(items);
  renderAll();
}

function saveItem() {
  if (!isAdmin()) return;
  const titleEl = document.getElementById('form-title');
  const title   = titleEl.value.trim();
  if (!title) { titleEl.style.borderColor = 'var(--danger)'; titleEl.focus(); return; }
  titleEl.style.borderColor = '';

  const tags = document.getElementById('form-tags').value
    .split(',').map(t => t.trim()).filter(Boolean);

  if (editingId) {
    const idx = items.findIndex(i => i.id === editingId);
    if (idx !== -1) {
      items[idx] = {
        ...items[idx],
        type:      document.getElementById('form-type').value,
        title,
        content:   document.getElementById('form-content').value.trim(),
        tags,
        updatedAt: new Date().toISOString(),
      };
    }
  } else {
    items.push({
      id:        genId(),
      type:      document.getElementById('form-type').value,
      title,
      content:   document.getElementById('form-content').value.trim(),
      tags,
      hidden:    false,
      createdAt: new Date().toISOString(),
    });
  }

  saveItems(items);
  closeModal();
  renderAll();
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ
function openModal() {
  document.getElementById('modal').classList.add('open');
  setTimeout(() => document.getElementById('form-title').focus(), 50);
}
function closeModal() {
  document.getElementById('modal').classList.remove('open');
  editingId = null;
}

// ‚îÄ‚îÄ EVENTS ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  if (isLoggedIn()) {
    showPlatform();
  } else {
    showLogin();
  }

  document.getElementById('login-btn').addEventListener('click', tryLogin);
  document.getElementById('password-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') tryLogin();
  });

  document.getElementById('logout-btn').addEventListener('click', logout);
  document.getElementById('add-btn').addEventListener('click', openAdd);

  document.querySelectorAll('.tab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeTab = btn.dataset.tab;
      renderCards();
    });
  });

  document.getElementById('search-input').addEventListener('input', e => {
    searchQuery = e.target.value.trim();
    renderCards();
  });

  document.getElementById('modal-close').addEventListener('click', closeModal);
  document.getElementById('modal-cancel').addEventListener('click', closeModal);
  document.getElementById('modal-save').addEventListener('click', saveItem);
  document.getElementById('modal').addEventListener('click', e => {
    if (e.target === document.getElementById('modal')) closeModal();
  });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
});
</script>
</body>
</html>
